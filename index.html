<!DOCTYPE html>
<html lang="en" class="sl-theme-dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Room: The Boys</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.1/cdn/themes/dark.css"
    />
    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.1/cdn/shoelace-autoloader.js"
    ></script>
    <style>
      body {
        font-family: var(--sl-font-sans);
        display: flex;
        justify-content: center;
        min-height: 75vh;
        padding: 1.25rem;
      }
      #chat-container {
        display: none;
      }
      #messages {
        height: 50vh;
        overflow-y: auto;
        border: 1px solid var(--sl-color-neutral-200);
        border-radius: var(--sl-border-radius-medium);
        padding: 10px;
        margin-bottom: 10px;
      }
      .message {
        margin-bottom: 15px;
        display: flex;
        flex-direction: column;
      }
      .message-user {
        font-size: 0.8em;
        color: var(--sl-color-neutral-500);
        margin-bottom: 2px;
      }
      .message-content {
        border-radius: var(--sl-border-radius-medium);
        padding: 8px 12px;
        display: inline-block;
        max-width: 80%;
      }
      .message-sent {
        align-items: flex-start;
      }
      .message-sent .message-content {
        background-color: #007aff;
        color: white;
      }
      .message-received {
        align-items: flex-end;
      }
      .message-received .message-content {
        background-color: var(--sl-color-neutral-200);
      }
      #message-input {
        width: 100%;
        margin-bottom: 10px;
      }
      #send-btn {
        color: #4495ed;
        cursor: pointer;
        font-size: 20px;
      }
    </style>
  </head>
  <body>
    <sl-card style="width: 500px">
      <h1 slot="header">Chat Room: Gang Activity</h1>
      <div id="connect-container">
        <sl-input
          id="username-input"
          filled
          placeholder="Enter your username"
        ></sl-input
        ><br />
        <sl-button id="connect-btn" variant="primary">Connect</sl-button>
      </div>
      <div id="chat-container">
        <div id="messages"></div>
        <sl-input id="message-input" filled placeholder="Type your message">
          <sl-icon id="send-btn" name="send" slot="suffix"></sl-icon
        ></sl-input>
      </div>
    </sl-card>

    <script>
      let ws;
      const connectContainer = document.getElementById("connect-container");
      const chatContainer = document.getElementById("chat-container");
      const messagesContainer = document.getElementById("messages");
      const usernameInput = document.getElementById("username-input");
      const messageInput = document.getElementById("message-input");
      const connectBtn = document.getElementById("connect-btn");
      const sendBtn = document.getElementById("send-btn");

      connectBtn.addEventListener("click", connectToChat);
      sendBtn.addEventListener("click", sendMessage);

      function connectToChat() {
        const username = usernameInput.value.trim();
        if (!username) {
          alert("Please enter a username");
          return;
        }

        ws = new WebSocket("ws://localhost:8080");

        ws.addEventListener("open", () => {
          console.log("WebSocket connection established");
          connectContainer.style.display = "none";
          chatContainer.style.display = "block";
          addSystemMessage("Connected to chat room");
        });

        ws.addEventListener("close", () => {
          console.log("WebSocket connection closed");
          addSystemMessage("Disconnected from chat room");
        });

        ws.addEventListener("error", () => {
          console.log("WebSocket error");
          addSystemMessage("Error connecting to chat room");
        });

        ws.addEventListener("message", (event) => {
          const message = JSON.parse(event.data);
          addMessage(message);
        });
      }

      function sendMessage() {
        const content = messageInput.value.trim();
        if (!content) return;

        const message = {
          user: usernameInput.value,
          content: content,
        };

        ws.send(JSON.stringify(message));
        messageInput.value = "";
      }

      function addMessage({ user, content }) {
        const isSentMessage = user === usernameInput.value;

        const messageElement = document.createElement("div");
        messageElement.className = `message ${
          isSentMessage ? "message-sent" : "message-received"
        }`;
        messageElement.innerHTML = `
            <div class="message-user">${user}</div>
            <div class="message-content">${content}</div>
        `;
        messagesContainer.appendChild(messageElement);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        messageInput.focus();
      }

      function addSystemMessage(content) {
        const systemMsg = document.createElement("div");
        systemMsg.innerHTML = `
            <sl-alert open style="margin-bottom: 1rem;">
            <sl-icon slot="icon" name="info-circle"></sl-icon>
                ${content}
            </sl-alert>
        `;
        messagesContainer.appendChild(systemMsg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      // Allow sending messages with Enter key
      messageInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
          sendMessage();
        }
      });
    </script>
  </body>
</html>
